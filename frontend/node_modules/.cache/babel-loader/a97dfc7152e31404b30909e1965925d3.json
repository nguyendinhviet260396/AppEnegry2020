{"ast":null,"code":"import { mat3 } from '@antv/matrix-util';\nimport { clone } from '@antv/util';\nvar DELTA = 0.05;\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      sensitivity: 2,\n      minZoom: undefined,\n      maxZoom: undefined,\n      enableOptimize: false,\n      optimizeZoom: 0.7,\n      fixSelectedItems: {\n        fixAll: false,\n        fixLineWidth: false,\n        fixLabel: false,\n        fixState: 'selected'\n      }\n    };\n  },\n  getEvents: function getEvents() {\n    var fixSelectedItems = this.fixSelectedItems;\n    if (!fixSelectedItems.fixState) fixSelectedItems.fixState = 'selected';\n\n    if (fixSelectedItems.fixAll) {\n      fixSelectedItems.fixLineWidth = true;\n      fixSelectedItems.fixLabel = true;\n    }\n\n    return {\n      wheel: 'onWheel'\n    };\n  },\n  onWheel: function onWheel(e) {\n    var _this = this;\n\n    var _a = this,\n        graph = _a.graph,\n        fixSelectedItems = _a.fixSelectedItems;\n\n    if (!this.shouldUpdate.call(this, e)) {\n      return;\n    }\n\n    e.preventDefault();\n    var canvas = graph.get('canvas');\n    var point = canvas.getPointByClient(e.clientX, e.clientY);\n    var sensitivity = this.get('sensitivity');\n    var graphZoom = graph.getZoom();\n    var ratio = graphZoom;\n    var zoom = graphZoom; // 兼容IE、Firefox及Chrome\n\n    if (e.wheelDelta < 0) {\n      ratio = 1 - DELTA * sensitivity;\n    } else {\n      ratio = 1 / (1 - DELTA * sensitivity);\n    }\n\n    zoom = graphZoom * ratio; // const zoom = ratio * graphZoom;\n\n    var minZoom = this.get('minZoom') || graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    } // hide the shapes when the zoom ratio is smaller than optimizeZoom\n    // hide the shapes when zoomming\n\n\n    var enableOptimize = this.get('enableOptimize');\n\n    if (enableOptimize) {\n      var optimizeZoom_1 = this.get('optimizeZoom');\n      var optimized = this.get('optimized');\n      var nodes_1 = graph.getNodes();\n      var edges_1 = graph.getEdges();\n      var nodesLength_1 = nodes_1.length;\n      var edgesLength_1 = edges_1.length; // hiding\n\n      if (!optimized) {\n        for (var n = 0; n < nodesLength_1; n++) {\n          var node = nodes_1[n];\n\n          if (!node.destroyed) {\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n\n              if (!shape.destoryed && !shape.get('isKeyShape')) {\n                shape.hide();\n              }\n            }\n          }\n        }\n\n        for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n          var edge = edges_1[edgeIndex];\n          var children = edge.get('group').get('children');\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            shape.hide();\n          }\n        }\n\n        this.set('optimized', true);\n      } // showing after 100ms\n\n\n      clearTimeout(this.get('timeout'));\n      var timeout = setTimeout(function () {\n        var currentZoom = graph.getZoom();\n\n        var curOptimized = _this.get('optimized');\n\n        if (curOptimized) {\n          _this.set('optimized', false);\n\n          for (var n = 0; n < nodesLength_1; n++) {\n            var node = nodes_1[n];\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              node.getKeyShape().show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  shape.show();\n                }\n              }\n            }\n          }\n\n          for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n            var edge = edges_1[edgeIndex];\n            var children = edge.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              edge.getKeyShape().show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  shape.show();\n                }\n              }\n            }\n          }\n        }\n      }, 500);\n      this.set('timeout', timeout);\n    } // fix the items when zooming\n\n\n    if (graphZoom <= 1) {\n      var fixNodes = void 0,\n          fixEdges = void 0;\n\n      if (fixSelectedItems.fixAll || fixSelectedItems.fixLineWidth || fixSelectedItems.fixLabel) {\n        fixNodes = graph.findAllByState('node', fixSelectedItems.fixState);\n        fixEdges = graph.findAllByState('edge', fixSelectedItems.fixState);\n        var scale = graphZoom / zoom;\n        var fixNodesLength = fixNodes.length;\n\n        for (var fn = 0; fn < fixNodesLength; fn++) {\n          var node = fixNodes[fn];\n          var group = node.getContainer();\n          var nodeModel = node.getModel();\n          var originStyle = node.getOriginStyle();\n          var itemStateStyle = node.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = node.get('shapeFactory').getShape(nodeModel.shape || nodeModel.type).getStateStyle(fixSelectedItems.fixState, node)[fixSelectedItems.fixState];\n\n          if (fixSelectedItems.fixAll) {\n            if (zoom <= 1) {\n              var groupMatrix = clone(group.getMatrix());\n              if (!groupMatrix) groupMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n              var _b = node.getModel(),\n                  x = _b.x,\n                  y = _b.y;\n\n              mat3.translate(groupMatrix, groupMatrix, [-x, -y]);\n              mat3.scale(groupMatrix, groupMatrix, [scale, scale]);\n              mat3.translate(groupMatrix, groupMatrix, [x, y]);\n              group.setMatrix(groupMatrix);\n            }\n          } else {\n            var children = group.get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n              var fontSize = void 0,\n                  lineWidth = void 0;\n\n              if (fixSelectedItems.fixLabel) {\n                var shapeType = shape.get('type');\n\n                if (shapeType === 'text') {\n                  fontSize = shape.attr('fontSize') || 12;\n                  var itemStyle = itemStateStyle[shape.get('name')];\n                  var shapeStyle = shapeStateStyle[shape.get('name')];\n                  var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                  var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                  var oriFontSize = itemFontSize || shapeFontSize || 12;\n                  if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom); // * graphZoom / zoom\n\n                  if (lineWidth) break;\n                }\n              }\n\n              if (fixSelectedItems.fixLineWidth) {\n                if (shape.get('isKeyShape')) {\n                  lineWidth = shape.attr('lineWidth') || 0;\n                  var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || originStyle.lineWidth || 0;\n                  if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom); // * graphZoom / zoom\n\n                  if (fontSize) break;\n                }\n              }\n            }\n          }\n        }\n\n        var fixEdgesLength = fixEdges.length;\n\n        for (var fe = 0; fe < fixEdgesLength; fe++) {\n          var edge = fixEdges[fe];\n          var group = edge.getContainer();\n          var children = group.get('children');\n          var nodeModel = edge.getModel();\n          var itemStateStyle = edge.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = edge.get('shapeFactory').getShape(nodeModel.shape || nodeModel.type).getStateStyle(fixSelectedItems.fixState, edge)[fixSelectedItems.fixState];\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            var fontSize = void 0,\n                lineWidth = void 0;\n\n            if (fixSelectedItems.fixLabel || fixSelectedItems.fixAll) {\n              var shapeType = shape.get('type');\n\n              if (shapeType === 'text') {\n                fontSize = shape.attr('fontSize') || 12;\n                var itemStyle = itemStateStyle[shape.get('name')];\n                var shapeStyle = shapeStateStyle[shape.get('name')];\n                var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                var oriFontSize = itemFontSize || shapeFontSize || 12;\n                if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom);\n                if (lineWidth) break;\n              }\n            }\n\n            if (fixSelectedItems.fixLineWidth || fixSelectedItems.fixAll) {\n              if (shape.get('isKeyShape')) {\n                lineWidth = shape.attr('lineWidth') || 0;\n                var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || 1;\n                if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom);\n                if (fontSize) break;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    graph.emit('wheelzoom', e);\n  }\n};","map":{"version":3,"sources":["C:/Users/vietn/Desktop/AppEnegry2020/frontend/node_modules/@antv/g6/es/behavior/zoom-canvas.js"],"names":["mat3","clone","DELTA","getDefaultCfg","sensitivity","minZoom","undefined","maxZoom","enableOptimize","optimizeZoom","fixSelectedItems","fixAll","fixLineWidth","fixLabel","fixState","getEvents","wheel","onWheel","e","_this","_a","graph","shouldUpdate","call","preventDefault","canvas","get","point","getPointByClient","clientX","clientY","graphZoom","getZoom","ratio","zoom","wheelDelta","optimizeZoom_1","optimized","nodes_1","getNodes","edges_1","getEdges","nodesLength_1","length","edgesLength_1","n","node","destroyed","children","childrenLength","c","shape","destoryed","hide","edgeIndex","edge","set","clearTimeout","timeout","setTimeout","currentZoom","curOptimized","getKeyShape","show","fixNodes","fixEdges","findAllByState","scale","fixNodesLength","fn","group","getContainer","nodeModel","getModel","originStyle","getOriginStyle","itemStateStyle","getStateStyle","shapeStateStyle","getShape","type","groupMatrix","getMatrix","_b","x","y","translate","setMatrix","fontSize","lineWidth","shapeType","attr","itemStyle","shapeStyle","itemFontSize","shapeFontSize","oriFontSize","oriLineWidth","fixEdgesLength","fe","zoomTo","emit"],"mappings":"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","sourcesContent":["import { mat3 } from '@antv/matrix-util';\nimport { clone } from '@antv/util';\nvar DELTA = 0.05;\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      sensitivity: 2,\n      minZoom: undefined,\n      maxZoom: undefined,\n      enableOptimize: false,\n      optimizeZoom: 0.7,\n      fixSelectedItems: {\n        fixAll: false,\n        fixLineWidth: false,\n        fixLabel: false,\n        fixState: 'selected'\n      }\n    };\n  },\n  getEvents: function getEvents() {\n    var fixSelectedItems = this.fixSelectedItems;\n    if (!fixSelectedItems.fixState) fixSelectedItems.fixState = 'selected';\n\n    if (fixSelectedItems.fixAll) {\n      fixSelectedItems.fixLineWidth = true;\n      fixSelectedItems.fixLabel = true;\n    }\n\n    return {\n      wheel: 'onWheel'\n    };\n  },\n  onWheel: function onWheel(e) {\n    var _this = this;\n\n    var _a = this,\n        graph = _a.graph,\n        fixSelectedItems = _a.fixSelectedItems;\n\n    if (!this.shouldUpdate.call(this, e)) {\n      return;\n    }\n\n    e.preventDefault();\n    var canvas = graph.get('canvas');\n    var point = canvas.getPointByClient(e.clientX, e.clientY);\n    var sensitivity = this.get('sensitivity');\n    var graphZoom = graph.getZoom();\n    var ratio = graphZoom;\n    var zoom = graphZoom; // 兼容IE、Firefox及Chrome\n\n    if (e.wheelDelta < 0) {\n      ratio = 1 - DELTA * sensitivity;\n    } else {\n      ratio = 1 / (1 - DELTA * sensitivity);\n    }\n\n    zoom = graphZoom * ratio; // const zoom = ratio * graphZoom;\n\n    var minZoom = this.get('minZoom') || graph.get('minZoom');\n    var maxZoom = this.get('maxZoom') || graph.get('maxZoom');\n\n    if (zoom > maxZoom || zoom < minZoom) {\n      return;\n    } // hide the shapes when the zoom ratio is smaller than optimizeZoom\n    // hide the shapes when zoomming\n\n\n    var enableOptimize = this.get('enableOptimize');\n\n    if (enableOptimize) {\n      var optimizeZoom_1 = this.get('optimizeZoom');\n      var optimized = this.get('optimized');\n      var nodes_1 = graph.getNodes();\n      var edges_1 = graph.getEdges();\n      var nodesLength_1 = nodes_1.length;\n      var edgesLength_1 = edges_1.length; // hiding\n\n      if (!optimized) {\n        for (var n = 0; n < nodesLength_1; n++) {\n          var node = nodes_1[n];\n\n          if (!node.destroyed) {\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n\n              if (!shape.destoryed && !shape.get('isKeyShape')) {\n                shape.hide();\n              }\n            }\n          }\n        }\n\n        for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n          var edge = edges_1[edgeIndex];\n          var children = edge.get('group').get('children');\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            shape.hide();\n          }\n        }\n\n        this.set('optimized', true);\n      } // showing after 100ms\n\n\n      clearTimeout(this.get('timeout'));\n      var timeout = setTimeout(function () {\n        var currentZoom = graph.getZoom();\n\n        var curOptimized = _this.get('optimized');\n\n        if (curOptimized) {\n          _this.set('optimized', false);\n\n          for (var n = 0; n < nodesLength_1; n++) {\n            var node = nodes_1[n];\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              node.getKeyShape().show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  shape.show();\n                }\n              }\n            }\n          }\n\n          for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n            var edge = edges_1[edgeIndex];\n            var children = edge.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              edge.getKeyShape().show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  shape.show();\n                }\n              }\n            }\n          }\n        }\n      }, 500);\n      this.set('timeout', timeout);\n    } // fix the items when zooming\n\n\n    if (graphZoom <= 1) {\n      var fixNodes = void 0,\n          fixEdges = void 0;\n\n      if (fixSelectedItems.fixAll || fixSelectedItems.fixLineWidth || fixSelectedItems.fixLabel) {\n        fixNodes = graph.findAllByState('node', fixSelectedItems.fixState);\n        fixEdges = graph.findAllByState('edge', fixSelectedItems.fixState);\n        var scale = graphZoom / zoom;\n        var fixNodesLength = fixNodes.length;\n\n        for (var fn = 0; fn < fixNodesLength; fn++) {\n          var node = fixNodes[fn];\n          var group = node.getContainer();\n          var nodeModel = node.getModel();\n          var originStyle = node.getOriginStyle();\n          var itemStateStyle = node.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = node.get('shapeFactory').getShape(nodeModel.shape || nodeModel.type).getStateStyle(fixSelectedItems.fixState, node)[fixSelectedItems.fixState];\n\n          if (fixSelectedItems.fixAll) {\n            if (zoom <= 1) {\n              var groupMatrix = clone(group.getMatrix());\n              if (!groupMatrix) groupMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n              var _b = node.getModel(),\n                  x = _b.x,\n                  y = _b.y;\n\n              mat3.translate(groupMatrix, groupMatrix, [-x, -y]);\n              mat3.scale(groupMatrix, groupMatrix, [scale, scale]);\n              mat3.translate(groupMatrix, groupMatrix, [x, y]);\n              group.setMatrix(groupMatrix);\n            }\n          } else {\n            var children = group.get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n              var fontSize = void 0,\n                  lineWidth = void 0;\n\n              if (fixSelectedItems.fixLabel) {\n                var shapeType = shape.get('type');\n\n                if (shapeType === 'text') {\n                  fontSize = shape.attr('fontSize') || 12;\n                  var itemStyle = itemStateStyle[shape.get('name')];\n                  var shapeStyle = shapeStateStyle[shape.get('name')];\n                  var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                  var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                  var oriFontSize = itemFontSize || shapeFontSize || 12;\n                  if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom); // * graphZoom / zoom\n\n                  if (lineWidth) break;\n                }\n              }\n\n              if (fixSelectedItems.fixLineWidth) {\n                if (shape.get('isKeyShape')) {\n                  lineWidth = shape.attr('lineWidth') || 0;\n                  var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || originStyle.lineWidth || 0;\n                  if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom); // * graphZoom / zoom\n\n                  if (fontSize) break;\n                }\n              }\n            }\n          }\n        }\n\n        var fixEdgesLength = fixEdges.length;\n\n        for (var fe = 0; fe < fixEdgesLength; fe++) {\n          var edge = fixEdges[fe];\n          var group = edge.getContainer();\n          var children = group.get('children');\n          var nodeModel = edge.getModel();\n          var itemStateStyle = edge.getStateStyle(fixSelectedItems.fixState);\n          var shapeStateStyle = edge.get('shapeFactory').getShape(nodeModel.shape || nodeModel.type).getStateStyle(fixSelectedItems.fixState, edge)[fixSelectedItems.fixState];\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            var fontSize = void 0,\n                lineWidth = void 0;\n\n            if (fixSelectedItems.fixLabel || fixSelectedItems.fixAll) {\n              var shapeType = shape.get('type');\n\n              if (shapeType === 'text') {\n                fontSize = shape.attr('fontSize') || 12;\n                var itemStyle = itemStateStyle[shape.get('name')];\n                var shapeStyle = shapeStateStyle[shape.get('name')];\n                var itemFontSize = itemStyle ? itemStyle.fontSize : 12;\n                var shapeFontSize = shapeStyle ? shapeStyle.fontSize : 12;\n                var oriFontSize = itemFontSize || shapeFontSize || 12;\n                if (zoom <= 1) shape.attr('fontSize', oriFontSize / zoom);\n                if (lineWidth) break;\n              }\n            }\n\n            if (fixSelectedItems.fixLineWidth || fixSelectedItems.fixAll) {\n              if (shape.get('isKeyShape')) {\n                lineWidth = shape.attr('lineWidth') || 0;\n                var oriLineWidth = itemStateStyle.lineWidth || shapeStateStyle.lineWidth || 1;\n                if (zoom <= 1) shape.attr('lineWidth', oriLineWidth / zoom);\n                if (fontSize) break;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    graph.zoomTo(zoom, {\n      x: point.x,\n      y: point.y\n    });\n    graph.emit('wheelzoom', e);\n  }\n};"]},"metadata":{},"sourceType":"module"}