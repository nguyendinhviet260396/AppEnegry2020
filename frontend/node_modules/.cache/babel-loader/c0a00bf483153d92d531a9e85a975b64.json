{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { throttle, uniq, isEqual } from '@antv/util';\nimport { VIEW_LIFE_CIRCLE } from '../dependents';\nimport BaseInteraction from './base';\nimport BBox from '../util/bbox';\nimport TimeLine from '../components/timeline';\nvar DEFAULT_HEIGHT = 40;\n\nfunction getValidTimeLineConfig(interaction) {\n  return __assign({\n    loop: false,\n    auto: true,\n    height: DEFAULT_HEIGHT,\n    padding: [0, 20, 0, 0],\n    speed: 2\n  }, interaction);\n}\n\nvar TimeLineInteraction =\n/** @class */\nfunction (_super) {\n  __extends(TimeLineInteraction, _super);\n\n  function TimeLineInteraction() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.onChangeFn = throttle(_this.onChange.bind(_this), 20, {\n      leading: true\n    });\n    return _this;\n  }\n  /** TimeLineInteraction new 时的范围参数 interactionRange */\n\n\n  TimeLineInteraction.getInteractionRange = function (layerRange, interaction) {\n    var config = getValidTimeLineConfig(interaction);\n    var paddingTop = config.padding[0];\n    var paddingBottom = config.padding[2];\n    return new BBox(layerRange.minX, layerRange.maxY - config.height - paddingTop - paddingBottom, layerRange.width, config.height + paddingTop + paddingBottom);\n  };\n\n  TimeLineInteraction.prototype.setAnimate = function (isAnimate) {\n    var geometries = this.view.geometries;\n    this.view.animate(isAnimate);\n    geometries.forEach(function (geom) {\n      geom.animate(isAnimate);\n    });\n  };\n\n  TimeLineInteraction.prototype.start = function () {\n    return;\n  };\n\n  TimeLineInteraction.prototype.renderTimeLine = function () {\n    var _this = this;\n\n    this.config = getValidTimeLineConfig(this.getInteractionConfig());\n    var viewRange = this.view.viewBBox;\n    var _a = this.config,\n        loop = _a.loop,\n        padding = _a.padding,\n        speed = _a.speed;\n    var paddingTop = padding[0],\n        paddingRight = padding[1],\n        paddingBottom = padding[2],\n        paddingLeft = padding[3];\n    var range = this.getRange();\n    var ticks = this.getTicks();\n    var width = viewRange.width - paddingLeft - paddingRight;\n    var timeLineConfig = {\n      x: viewRange.minX + paddingLeft,\n      y: range.tl.y + paddingTop,\n      width: width,\n      height: range.height - paddingTop - paddingBottom,\n      loop: loop,\n      ticks: ticks,\n      speed: speed,\n      defaultCurrentTick: ticks[0]\n    };\n\n    if (this.timeline) {\n      if (!isEqual(timeLineConfig, this.timeLineConfig)) {\n        this.timeLineConfig = timeLineConfig;\n        this.timeline.update(timeLineConfig);\n      }\n    } else {\n      this.container = this.canvas.addGroup();\n      this.timeline = new TimeLine(__assign({\n        container: this.container\n      }, timeLineConfig));\n      this.timeline.init();\n      this.timeline.render();\n      this.timeline.on('timelinestart', function () {\n        _this.originAnimation = _this.view.getOptions().animate;\n\n        _this.setAnimate(true);\n      });\n      this.timeline.on('timelineend', function () {\n        _this.setAnimate(_this.originAnimation);\n      });\n      this.timeline.on('timelinechange', this.onChangeFn);\n      this.timeline.on('timelineupdate', this.onChange.bind(this));\n      this.view.data(this.getFilterData(ticks[0]));\n      this.timeLineConfig = timeLineConfig;\n    }\n  };\n\n  TimeLineInteraction.prototype.onChange = function (tick) {\n    var filterData = this.getFilterData(tick);\n    this.view.changeData(filterData);\n  };\n\n  TimeLineInteraction.prototype.getFilterData = function (tick) {\n    var field = this.config.field;\n    var data = this.getViewLayer().options.data;\n    return data.filter(function (item) {\n      return item[field] === tick;\n    });\n  };\n\n  TimeLineInteraction.prototype.getTicks = function () {\n    var field = this.config.field;\n    var data = this.getViewLayer().options.data;\n    return uniq(data.map(function (item) {\n      return item[field];\n    }));\n  };\n  /** 渲染 timeline */\n\n\n  TimeLineInteraction.prototype.render = function () {\n    var _this = this;\n\n    this.firstRender = true;\n    this.view.on(VIEW_LIFE_CIRCLE.BEFORE_RENDER, function () {\n      _this.renderTimeLine();\n    });\n    this.view.on(VIEW_LIFE_CIRCLE.BEFORE_PAINT, function () {\n      _this.renderTimeLine();\n    });\n    this.view.on(VIEW_LIFE_CIRCLE.AFTER_PAINT, function () {\n      if (_this.config.auto && _this.firstRender) {\n        _this.timeline.isPlay = true;\n\n        _this.timeline.changePlayStatus();\n      }\n\n      _this.firstRender = false;\n    });\n    this.view.on(VIEW_LIFE_CIRCLE.AFTER_RENDER, function () {\n      if (_this.config.auto && _this.firstRender) {\n        _this.timeline.isPlay = true;\n\n        _this.timeline.changePlayStatus();\n      }\n\n      _this.firstRender = false;\n    });\n  };\n\n  TimeLineInteraction.prototype.clear = function () {\n    if (this.timeline) {\n      this.timeline.destroy();\n      this.timeline = null;\n    }\n\n    if (this.container) {\n      this.container.remove(true);\n      this.container = null;\n    }\n  };\n\n  return TimeLineInteraction;\n}(BaseInteraction);\n\nexport default TimeLineInteraction;","map":{"version":3,"sources":["../../src/interaction/timeline.ts"],"names":[],"mappings":"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","sourcesContent":["import { throttle, uniq, isEqual } from '@antv/util';\nimport { IGroup, VIEW_LIFE_CIRCLE } from '../dependents';\nimport BaseInteraction from './base';\nimport { ITimeLineInteractionConfig } from '../interface/config';\nimport BBox from '../util/bbox';\nimport TimeLine from '../components/timeline';\n\nconst DEFAULT_HEIGHT = 40;\n\nfunction getValidTimeLineConfig(interaction: ITimeLineInteractionConfig): Required<ITimeLineInteractionConfig> {\n  return {\n    loop: false,\n    auto: true,\n    height: DEFAULT_HEIGHT,\n    padding: [0, 20, 0, 0],\n    speed: 2,\n    ...interaction,\n  };\n}\n\nexport default class TimeLineInteraction extends BaseInteraction {\n  private timeline: TimeLine;\n  private container: IGroup;\n  private onChangeFn: (tick: string) => void = throttle(this.onChange.bind(this), 20, { leading: true }) as (\n    tick: string\n  ) => void;\n  private config: ITimeLineInteractionConfig;\n  private originAnimation: any;\n  private timeLineConfig: any;\n  private firstRender: boolean;\n\n  /** TimeLineInteraction new 时的范围参数 interactionRange */\n  public static getInteractionRange(layerRange: BBox, interaction: ITimeLineInteractionConfig): BBox {\n    const config: ITimeLineInteractionConfig = getValidTimeLineConfig(interaction);\n    const paddingTop = config.padding[0];\n    const paddingBottom = config.padding[2];\n\n    return new BBox(\n      layerRange.minX,\n      layerRange.maxY - config.height - paddingTop - paddingBottom,\n      layerRange.width,\n      config.height + paddingTop + paddingBottom\n    );\n  }\n\n  private setAnimate(isAnimate: boolean) {\n    const geometries = this.view.geometries;\n    this.view.animate(isAnimate);\n    geometries.forEach((geom) => {\n      geom.animate(isAnimate);\n    });\n  }\n\n  protected start() {\n    return;\n  }\n\n  private renderTimeLine() {\n    this.config = getValidTimeLineConfig(this.getInteractionConfig() as ITimeLineInteractionConfig);\n\n    const viewRange = this.view.viewBBox;\n    const { loop, padding, speed } = this.config;\n    const [paddingTop, paddingRight, paddingBottom, paddingLeft] = padding;\n    const range = this.getRange();\n\n    const ticks = this.getTicks();\n    const width = viewRange.width - paddingLeft - paddingRight;\n    const timeLineConfig = {\n      x: viewRange.minX + paddingLeft,\n      y: range.tl.y + paddingTop,\n      width,\n      height: range.height - paddingTop - paddingBottom,\n      loop,\n      ticks,\n      speed,\n      defaultCurrentTick: ticks[0],\n    };\n\n    if (this.timeline) {\n      if (!isEqual(timeLineConfig, this.timeLineConfig)) {\n        this.timeLineConfig = timeLineConfig;\n        this.timeline.update(timeLineConfig);\n      }\n    } else {\n      this.container = this.canvas.addGroup();\n\n      this.timeline = new TimeLine({\n        container: this.container,\n        ...timeLineConfig,\n      });\n      this.timeline.init();\n      this.timeline.render();\n      this.timeline.on('timelinestart', () => {\n        this.originAnimation = this.view.getOptions().animate;\n        this.setAnimate(true);\n      });\n      this.timeline.on('timelineend', () => {\n        this.setAnimate(this.originAnimation);\n      });\n      this.timeline.on('timelinechange', this.onChangeFn);\n      this.timeline.on('timelineupdate', this.onChange.bind(this));\n      this.view.data(this.getFilterData(ticks[0]));\n      this.timeLineConfig = timeLineConfig;\n    }\n  }\n\n  private onChange(tick: string) {\n    const filterData = this.getFilterData(tick);\n    this.view.changeData(filterData);\n  }\n\n  private getFilterData(tick: string) {\n    const { field } = this.config;\n    const { data } = this.getViewLayer().options;\n    return data.filter((item) => item[field] === tick);\n  }\n\n  private getTicks() {\n    const { field } = this.config;\n    const { data } = this.getViewLayer().options;\n    return uniq(data.map((item) => item[field]));\n  }\n\n  /** 渲染 timeline */\n  public render(): void {\n    this.firstRender = true;\n    this.view.on(VIEW_LIFE_CIRCLE.BEFORE_RENDER, () => {\n      this.renderTimeLine();\n    });\n    this.view.on(VIEW_LIFE_CIRCLE.BEFORE_PAINT, () => {\n      this.renderTimeLine();\n    });\n    this.view.on(VIEW_LIFE_CIRCLE.AFTER_PAINT, () => {\n      if (this.config.auto && this.firstRender) {\n        this.timeline.isPlay = true;\n        this.timeline.changePlayStatus();\n      }\n      this.firstRender = false;\n    });\n    this.view.on(VIEW_LIFE_CIRCLE.AFTER_RENDER, () => {\n      if (this.config.auto && this.firstRender) {\n        this.timeline.isPlay = true;\n        this.timeline.changePlayStatus();\n      }\n      this.firstRender = false;\n    });\n  }\n\n  protected clear(): void {\n    if (this.timeline) {\n      this.timeline.destroy();\n      this.timeline = null;\n    }\n    if (this.container) {\n      this.container.remove(true);\n      this.container = null;\n    }\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}