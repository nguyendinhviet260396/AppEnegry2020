{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { find, map } from '@antv/util';\n\nvar BulletTarget =\n/** @class */\nfunction () {\n  function BulletTarget(view, cfg) {\n    this.view = view;\n    this.cfg = cfg;\n\n    this._init();\n  }\n  /** 绘制辅助labels */\n\n\n  BulletTarget.prototype.draw = function () {\n    if (!this.view || this.view.destroyed) {\n      return;\n    }\n\n    this.container = this.view.foregroundGroup.addGroup();\n    this.container.set('name', 'targetGroups');\n    var shapes = map(this.getGeometry().elements, function (element) {\n      return element.shape;\n    });\n\n    for (var i = 0; i < this.cfg.targets.length; i += 1) {\n      var shapeBox = shapes[i].getBBox();\n      var widthRatio = shapeBox.width / shapes[i].get('origin').data[this.cfg.yField];\n      this.drawTarget(shapeBox, this.cfg.targets[i], widthRatio);\n    }\n\n    this.view.canvas.draw();\n  };\n\n  BulletTarget.prototype.drawTarget = function (box, targets, widthRatio) {\n    var _this = this;\n\n    var options = this.cfg;\n    var colors = options.markerColors;\n    /** 添加目标值 */\n\n    targets.forEach(function (target, i) {\n      var markerStyle = options.markerStyle;\n\n      _this.container.addShape('rect', {\n        name: 'bullet-target',\n        attrs: __assign(__assign({\n          width: markerStyle.width,\n          height: box.height * options.markerSize - markerStyle.width / 2,\n          x: box.minX + target * widthRatio,\n          y: box.minY - box.height * (options.markerSize - 1) / 2\n        }, markerStyle), {\n          fill: colors[i % colors.length] || markerStyle.fill\n        })\n      });\n    });\n  };\n\n  BulletTarget.prototype.clear = function () {\n    if (this.container) {\n      this.container.clear();\n    }\n  };\n\n  BulletTarget.prototype.destroy = function () {\n    if (this.container) {\n      this.container.remove();\n    }\n  };\n\n  BulletTarget.prototype._init = function () {\n    var _this = this;\n\n    this.view.on('beforerender', function () {\n      _this.clear();\n    });\n    this.view.on('afterrender', function () {\n      _this.draw();\n    });\n  };\n\n  BulletTarget.prototype.getGeometry = function () {\n    return find(this.view.geometries, function (geometry) {\n      return geometry.type === 'interval';\n    });\n  };\n\n  return BulletTarget;\n}();\n\nexport default BulletTarget;","map":{"version":3,"sources":["../../../../src/plots/bullet/component/bulletTarget.ts"],"names":[],"mappings":"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","sourcesContent":["import BBox from '../../../util/bbox';\nimport { View, Geometry, IGroup } from '../../../dependents';\nimport { find, map } from '@antv/util';\n\nexport interface BulletTargetCfg {\n  targets: number[][];\n  markerSize: number;\n  yField: string;\n  markerColors: string[];\n  markerStyle?: {\n    fill?: string;\n    stroke?: string;\n    strokeOpacity?: number;\n    [k: string]: any;\n  };\n}\n\nexport default class BulletTarget {\n  private view: View;\n  private container: IGroup;\n  private cfg: BulletTargetCfg;\n\n  constructor(view: View, cfg: BulletTargetCfg) {\n    this.view = view;\n    this.cfg = cfg;\n    this._init();\n  }\n\n  /** 绘制辅助labels */\n  public draw() {\n    if (!this.view || this.view.destroyed) {\n      return;\n    }\n    this.container = this.view.foregroundGroup.addGroup();\n    this.container.set('name', 'targetGroups');\n    const shapes = map(this.getGeometry().elements, (element: any) => element.shape);\n    for (let i = 0; i < this.cfg.targets.length; i += 1) {\n      const shapeBox = shapes[i].getBBox();\n      const widthRatio = shapeBox.width / shapes[i].get('origin').data[this.cfg.yField];\n      this.drawTarget(shapeBox, this.cfg.targets[i], widthRatio);\n    }\n    this.view.canvas.draw();\n  }\n\n  protected drawTarget(box: BBox, targets: number[], widthRatio: number) {\n    const options = this.cfg;\n    const colors = options.markerColors;\n    /** 添加目标值 */\n    targets.forEach((target: number, i) => {\n      const markerStyle = options.markerStyle;\n      this.container.addShape('rect', {\n        name: 'bullet-target',\n        attrs: {\n          width: markerStyle.width,\n          height: box.height * options.markerSize - markerStyle.width / 2,\n          x: box.minX + target * widthRatio,\n          y: box.minY - (box.height * (options.markerSize - 1)) / 2,\n          ...markerStyle,\n          fill: colors[i % colors.length] || markerStyle.fill,\n        },\n      });\n    });\n  }\n\n  public clear() {\n    if (this.container) {\n      this.container.clear();\n    }\n  }\n\n  public destroy() {\n    if (this.container) {\n      this.container.remove();\n    }\n  }\n\n  private _init() {\n    this.view.on('beforerender', () => {\n      this.clear();\n    });\n\n    this.view.on('afterrender', () => {\n      this.draw();\n    });\n  }\n\n  private getGeometry() {\n    return find(this.view.geometries, (geometry) => geometry.type === 'interval') as Geometry;\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}