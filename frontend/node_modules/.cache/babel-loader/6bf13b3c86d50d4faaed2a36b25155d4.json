{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { clone } from '@antv/util/lib';\nimport Base from '../base';\nvar DELTA = 0.05;\nvar lensDelegateStyle = {\n  stroke: '#000',\n  strokeOpacity: 0.8,\n  lineWidth: 2,\n  fillOpacity: 0.1,\n  fill: '#ccc'\n};\n\nvar Fisheye =\n/** @class */\nfunction (_super) {\n  __extends(Fisheye, _super);\n\n  function Fisheye() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Fisheye.prototype.getDefaultCfgs = function () {\n    return {\n      trigger: 'mousemove',\n      d: 1.5,\n      r: 300,\n      delegateStyle: clone(lensDelegateStyle),\n      showLabel: false,\n      maxD: 5,\n      minD: 0\n    };\n  }; // class-methods-use-this\n\n\n  Fisheye.prototype.getEvents = function () {\n    var events;\n\n    switch (this.get('trigger')) {\n      case 'click':\n        events = {\n          click: 'magnify'\n        };\n        break;\n\n      case 'drag':\n        events = {\n          click: 'createDelegate'\n        };\n        break;\n\n      default:\n        events = {\n          mousemove: 'magnify'\n        };\n        break;\n    }\n\n    return events;\n  };\n\n  Fisheye.prototype.init = function () {\n    var self = this;\n    var r = self.get('r');\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n  };\n\n  Fisheye.prototype.createDelegate = function (e) {\n    var self = this;\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      self.magnify(e);\n      lensDelegate = self.get('delegate');\n      lensDelegate.on('dragstart', function (evt) {\n        self.set('delegateCenterDiff', {\n          x: lensDelegate.attr('x') - evt.x,\n          y: lensDelegate.attr('y') - evt.y\n        });\n      });\n      lensDelegate.on('drag', function (evt) {\n        self.magnify(evt);\n      });\n\n      if (this.get('scaleRByWheel')) {\n        lensDelegate.on('mousewheel', function (evt) {\n          self.scaleRange(evt);\n        });\n      }\n    }\n  };\n  /**\n   * 调整放大镜范围\n   * @param e wheel 事件\n   */\n\n\n  Fisheye.prototype.scaleRange = function (e) {\n    if (!e && !e.originalEvent) return;\n    var self = this;\n    var graph = self.get('graph');\n    var ratio;\n    var mousePos = graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.originalEvent.wheelDelta < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.magnify(e, mousePos);\n  };\n  /**\n   * mousemove、click、drag 事件的响应函数\n   * @param e 鼠标事件\n   */\n\n\n  Fisheye.prototype.magnify = function (e, mousePos) {\n    var self = this;\n    self.restoreCache();\n    var graph = self.get('graph');\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var showLabel = self.get('showLabel');\n    var r = self.get('r');\n    var r2 = self.get('r2');\n    var d = self.get('d');\n    var molecularParam = self.get('molecularParam');\n    var nodes = graph.getNodes();\n    var nodeLength = nodes.length;\n    var mCenter = mousePos ? {\n      x: mousePos.x,\n      y: mousePos.y\n    } : {\n      x: e.x,\n      y: e.y\n    };\n\n    if (self.get('dragging') && (self.get('trigger') === 'mousemove' || self.get('trigger') === 'click')) {\n      mCenter = self.get('cacheCenter');\n    }\n\n    var delegateCenterDiff = self.get('delegateCenterDiff');\n\n    if (delegateCenterDiff) {\n      mCenter.x += delegateCenterDiff.x;\n      mCenter.y += delegateCenterDiff.y;\n    }\n\n    self.updateDelegate(mCenter, r);\n\n    for (var i = 0; i < nodeLength; i++) {\n      var model = nodes[i].getModel();\n      var x = model.x,\n          y = model.y;\n      if (isNaN(x) || isNaN(y)) continue; // the square of the distance between the node and the magnified center\n\n      var dist2 = (x - mCenter.x) * (x - mCenter.x) + (y - mCenter.y) * (y - mCenter.y);\n\n      if (!isNaN(dist2) && dist2 < r2 && dist2 !== 0) {\n        var dist = Math.sqrt(dist2); // (r * (d + 1) * (dist / r)) / (d * (dist / r) + 1);\n\n        var magnifiedDist = molecularParam * dist / (d * dist + r);\n        var cos = (x - mCenter.x) / dist;\n        var sin = (y - mCenter.y) / dist;\n        model.x = cos * magnifiedDist + mCenter.x;\n        model.y = sin * magnifiedDist + mCenter.y;\n\n        if (!cachedOriginPositions[model.id]) {\n          cachedOriginPositions[model.id] = {\n            x: x,\n            y: y,\n            texts: []\n          };\n        }\n\n        cachedMagnifiedModels.push(model);\n\n        if (showLabel && 2 * dist < r) {\n          var node = nodes[i];\n          var nodeGroup = node.getContainer();\n          var shapes = nodeGroup.getChildren();\n          var shapeLength = shapes.length;\n\n          for (var j = 0; j < shapeLength; j++) {\n            var shape = shapes[j];\n\n            if (shape.get('type') === 'text') {\n              cachedOriginPositions[model.id].texts.push({\n                visible: shape.get('visible'),\n                shape: shape\n              });\n              shape.set('visible', true);\n            }\n          }\n        }\n      }\n    }\n\n    graph.refreshPositions();\n  };\n  /**\n   * 恢复缓存的被缩放的节点\n   */\n\n\n  Fisheye.prototype.restoreCache = function () {\n    var self = this;\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var cacheLength = cachedMagnifiedModels.length;\n\n    for (var i = 0; i < cacheLength; i++) {\n      var node = cachedMagnifiedModels[i];\n      var id = node.id;\n      var ori = cachedOriginPositions[id];\n      node.x = ori.x;\n      node.y = ori.y;\n      var textLength = ori.texts.length;\n\n      for (var j = 0; j < textLength; j++) {\n        var text = ori.texts[j];\n        text.shape.set('visible', text.visible);\n      }\n    }\n\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n  };\n  /**\n   * 提供给用户调整系数\n   * @param {Point} mCenter\n   * @param {number} r\n   */\n\n\n  Fisheye.prototype.updateParams = function (cfg) {\n    var self = this;\n    var r = cfg.r,\n        d = cfg.d,\n        trigger = cfg.trigger,\n        minD = cfg.minD,\n        maxD = cfg.maxD,\n        minR = cfg.minR,\n        maxR = cfg.maxR;\n\n    if (!isNaN(cfg.r)) {\n      self.set('r', r);\n      self.set('r2', r * r);\n    }\n\n    if (!isNaN(d)) {\n      self.set('d', d);\n    }\n\n    if (!isNaN(maxD)) {\n      self.set('maxD', maxD);\n    }\n\n    if (!isNaN(minD)) {\n      self.set('minD', minD);\n    }\n\n    if (!isNaN(maxR)) {\n      self.set('maxR', maxR);\n    }\n\n    if (!isNaN(minR)) {\n      self.set('minR', minR);\n    }\n\n    var nd = self.get('d');\n    var nr = self.get('r');\n    self.set('molecularParam', (nd + 1) * nr);\n\n    if (trigger === 'mousemove' || trigger === 'click' || trigger === 'drag') {\n      self.set('trigger', trigger);\n    }\n  };\n  /**\n   * 放大镜的图形\n   * @param {Point} mCenter\n   * @param {number} r\n   */\n\n\n  Fisheye.prototype.updateDelegate = function (mCenter, r) {\n    var self = this;\n    var graph = self.get('graph');\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      // 拖动多个\n      var parent_1 = graph.get('group');\n      var attrs = self.get('delegateStyle') || lensDelegateStyle; // model上的x, y是相对于图形中心的，delegateShape是g实例，x,y是绝对坐标\n\n      lensDelegate = parent_1.addShape('circle', {\n        attrs: __assign({\n          r: r / 1.5,\n          x: mCenter.x,\n          y: mCenter.y\n        }, attrs),\n        name: 'lens-shape',\n        draggable: true\n      });\n\n      if (this.get('scaleRByWheel')) {\n        lensDelegate.on('mousewheel', function (evt) {\n          self.scaleRange(evt);\n        });\n      }\n\n      lensDelegate.on('dragstart', function (e) {\n        self.set('dragging', true);\n        self.set('cacheCenter', {\n          x: e.x,\n          y: e.y\n        });\n        self.set('dragPrePos', {\n          x: e.x,\n          y: e.y\n        });\n      });\n      lensDelegate.on('drag', function (e) {\n        var dragPrePos = self.get('dragPrePos');\n        var delta = e.x - dragPrePos.x > 0 ? 0.1 : -0.1;\n        var d = self.get('d');\n        var newD = d + delta;\n        var maxD = self.get('maxD');\n        var minD = self.get('minD');\n\n        if (newD < maxD && newD > minD) {\n          self.set('d', newD);\n          r = self.get('r');\n          self.set('molecularParam', (newD + 1) * r);\n          self.magnify(e);\n        }\n\n        self.set('dragPrePos', {\n          x: e.x,\n          y: e.y\n        });\n      });\n      lensDelegate.on('dragend', function (e) {\n        self.set('dragging', false);\n      });\n    } else {\n      lensDelegate.attr({\n        x: mCenter.x,\n        y: mCenter.y,\n        r: r / 1.5\n      });\n    }\n\n    self.set('delegate', lensDelegate);\n  };\n\n  Fisheye.prototype.clear = function () {\n    var graph = this.get('graph');\n    this.restoreCache();\n    graph.refreshPositions();\n    var lensDelegate = this.get('delegate');\n\n    if (lensDelegate && !lensDelegate.destroyed) {\n      lensDelegate.remove();\n      lensDelegate.destroy();\n    }\n  };\n\n  Fisheye.prototype.destroy = function () {\n    this.clear();\n  };\n\n  return Fisheye;\n}(Base);\n\nexport default Fisheye;","map":{"version":3,"sources":["C:/Users/vietn/Desktop/AppEnegry2020/frontend/node_modules/@antv/g6/es/plugins/fisheye/index.js"],"names":["__assign","__extends","clone","Base","DELTA","lensDelegateStyle","stroke","strokeOpacity","lineWidth","fillOpacity","fill","Fisheye","_super","apply","arguments","prototype","getDefaultCfgs","trigger","d","r","delegateStyle","showLabel","maxD","minD","getEvents","events","get","click","mousemove","init","self","set","createDelegate","e","lensDelegate","destroyed","magnify","on","evt","x","attr","y","scaleRange","originalEvent","graph","ratio","mousePos","getPointByClient","clientX","clientY","wheelDelta","maxR","minR","restoreCache","cachedMagnifiedModels","cachedOriginPositions","r2","molecularParam","nodes","getNodes","nodeLength","length","mCenter","delegateCenterDiff","updateDelegate","i","model","getModel","isNaN","dist2","dist","Math","sqrt","magnifiedDist","cos","sin","id","texts","push","node","nodeGroup","getContainer","shapes","getChildren","shapeLength","j","shape","visible","refreshPositions","cacheLength","ori","textLength","text","updateParams","cfg","nd","nr","parent_1","attrs","addShape","name","draggable","dragPrePos","delta","newD","clear","remove","destroy"],"mappings":"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","sourcesContent":["import { __assign, __extends } from \"tslib\";\nimport { clone } from '@antv/util/lib';\nimport Base from '../base';\nvar DELTA = 0.05;\nvar lensDelegateStyle = {\n  stroke: '#000',\n  strokeOpacity: 0.8,\n  lineWidth: 2,\n  fillOpacity: 0.1,\n  fill: '#ccc'\n};\n\nvar Fisheye =\n/** @class */\nfunction (_super) {\n  __extends(Fisheye, _super);\n\n  function Fisheye() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Fisheye.prototype.getDefaultCfgs = function () {\n    return {\n      trigger: 'mousemove',\n      d: 1.5,\n      r: 300,\n      delegateStyle: clone(lensDelegateStyle),\n      showLabel: false,\n      maxD: 5,\n      minD: 0\n    };\n  }; // class-methods-use-this\n\n\n  Fisheye.prototype.getEvents = function () {\n    var events;\n\n    switch (this.get('trigger')) {\n      case 'click':\n        events = {\n          click: 'magnify'\n        };\n        break;\n\n      case 'drag':\n        events = {\n          click: 'createDelegate'\n        };\n        break;\n\n      default:\n        events = {\n          mousemove: 'magnify'\n        };\n        break;\n    }\n\n    return events;\n  };\n\n  Fisheye.prototype.init = function () {\n    var self = this;\n    var r = self.get('r');\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n  };\n\n  Fisheye.prototype.createDelegate = function (e) {\n    var self = this;\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      self.magnify(e);\n      lensDelegate = self.get('delegate');\n      lensDelegate.on('dragstart', function (evt) {\n        self.set('delegateCenterDiff', {\n          x: lensDelegate.attr('x') - evt.x,\n          y: lensDelegate.attr('y') - evt.y\n        });\n      });\n      lensDelegate.on('drag', function (evt) {\n        self.magnify(evt);\n      });\n\n      if (this.get('scaleRByWheel')) {\n        lensDelegate.on('mousewheel', function (evt) {\n          self.scaleRange(evt);\n        });\n      }\n    }\n  };\n  /**\n   * 调整放大镜范围\n   * @param e wheel 事件\n   */\n\n\n  Fisheye.prototype.scaleRange = function (e) {\n    if (!e && !e.originalEvent) return;\n    var self = this;\n    var graph = self.get('graph');\n    var ratio;\n    var mousePos = graph.getPointByClient(e.clientX, e.clientY);\n\n    if (e.originalEvent.wheelDelta < 0) {\n      ratio = 1 - DELTA;\n    } else {\n      ratio = 1 / (1 - DELTA);\n    }\n\n    var maxR = self.get('maxR');\n    var minR = self.get('minR');\n    var r = self.get('r');\n\n    if (r > (maxR || graph.get('height')) && ratio > 1 || r < (minR || graph.get('height') * 0.05) && ratio < 1) {\n      ratio = 1;\n    }\n\n    r *= ratio;\n    self.set('r', r);\n    self.set('r2', r * r);\n    var d = self.get('d');\n    self.set('molecularParam', (d + 1) * r);\n    self.magnify(e, mousePos);\n  };\n  /**\n   * mousemove、click、drag 事件的响应函数\n   * @param e 鼠标事件\n   */\n\n\n  Fisheye.prototype.magnify = function (e, mousePos) {\n    var self = this;\n    self.restoreCache();\n    var graph = self.get('graph');\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var showLabel = self.get('showLabel');\n    var r = self.get('r');\n    var r2 = self.get('r2');\n    var d = self.get('d');\n    var molecularParam = self.get('molecularParam');\n    var nodes = graph.getNodes();\n    var nodeLength = nodes.length;\n    var mCenter = mousePos ? {\n      x: mousePos.x,\n      y: mousePos.y\n    } : {\n      x: e.x,\n      y: e.y\n    };\n\n    if (self.get('dragging') && (self.get('trigger') === 'mousemove' || self.get('trigger') === 'click')) {\n      mCenter = self.get('cacheCenter');\n    }\n\n    var delegateCenterDiff = self.get('delegateCenterDiff');\n\n    if (delegateCenterDiff) {\n      mCenter.x += delegateCenterDiff.x;\n      mCenter.y += delegateCenterDiff.y;\n    }\n\n    self.updateDelegate(mCenter, r);\n\n    for (var i = 0; i < nodeLength; i++) {\n      var model = nodes[i].getModel();\n      var x = model.x,\n          y = model.y;\n      if (isNaN(x) || isNaN(y)) continue; // the square of the distance between the node and the magnified center\n\n      var dist2 = (x - mCenter.x) * (x - mCenter.x) + (y - mCenter.y) * (y - mCenter.y);\n\n      if (!isNaN(dist2) && dist2 < r2 && dist2 !== 0) {\n        var dist = Math.sqrt(dist2); // (r * (d + 1) * (dist / r)) / (d * (dist / r) + 1);\n\n        var magnifiedDist = molecularParam * dist / (d * dist + r);\n        var cos = (x - mCenter.x) / dist;\n        var sin = (y - mCenter.y) / dist;\n        model.x = cos * magnifiedDist + mCenter.x;\n        model.y = sin * magnifiedDist + mCenter.y;\n\n        if (!cachedOriginPositions[model.id]) {\n          cachedOriginPositions[model.id] = {\n            x: x,\n            y: y,\n            texts: []\n          };\n        }\n\n        cachedMagnifiedModels.push(model);\n\n        if (showLabel && 2 * dist < r) {\n          var node = nodes[i];\n          var nodeGroup = node.getContainer();\n          var shapes = nodeGroup.getChildren();\n          var shapeLength = shapes.length;\n\n          for (var j = 0; j < shapeLength; j++) {\n            var shape = shapes[j];\n\n            if (shape.get('type') === 'text') {\n              cachedOriginPositions[model.id].texts.push({\n                visible: shape.get('visible'),\n                shape: shape\n              });\n              shape.set('visible', true);\n            }\n          }\n        }\n      }\n    }\n\n    graph.refreshPositions();\n  };\n  /**\n   * 恢复缓存的被缩放的节点\n   */\n\n\n  Fisheye.prototype.restoreCache = function () {\n    var self = this;\n    var cachedMagnifiedModels = self.get('cachedMagnifiedModels');\n    var cachedOriginPositions = self.get('cachedOriginPositions');\n    var cacheLength = cachedMagnifiedModels.length;\n\n    for (var i = 0; i < cacheLength; i++) {\n      var node = cachedMagnifiedModels[i];\n      var id = node.id;\n      var ori = cachedOriginPositions[id];\n      node.x = ori.x;\n      node.y = ori.y;\n      var textLength = ori.texts.length;\n\n      for (var j = 0; j < textLength; j++) {\n        var text = ori.texts[j];\n        text.shape.set('visible', text.visible);\n      }\n    }\n\n    self.set('cachedMagnifiedModels', []);\n    self.set('cachedOriginPositions', {});\n  };\n  /**\n   * 提供给用户调整系数\n   * @param {Point} mCenter\n   * @param {number} r\n   */\n\n\n  Fisheye.prototype.updateParams = function (cfg) {\n    var self = this;\n    var r = cfg.r,\n        d = cfg.d,\n        trigger = cfg.trigger,\n        minD = cfg.minD,\n        maxD = cfg.maxD,\n        minR = cfg.minR,\n        maxR = cfg.maxR;\n\n    if (!isNaN(cfg.r)) {\n      self.set('r', r);\n      self.set('r2', r * r);\n    }\n\n    if (!isNaN(d)) {\n      self.set('d', d);\n    }\n\n    if (!isNaN(maxD)) {\n      self.set('maxD', maxD);\n    }\n\n    if (!isNaN(minD)) {\n      self.set('minD', minD);\n    }\n\n    if (!isNaN(maxR)) {\n      self.set('maxR', maxR);\n    }\n\n    if (!isNaN(minR)) {\n      self.set('minR', minR);\n    }\n\n    var nd = self.get('d');\n    var nr = self.get('r');\n    self.set('molecularParam', (nd + 1) * nr);\n\n    if (trigger === 'mousemove' || trigger === 'click' || trigger === 'drag') {\n      self.set('trigger', trigger);\n    }\n  };\n  /**\n   * 放大镜的图形\n   * @param {Point} mCenter\n   * @param {number} r\n   */\n\n\n  Fisheye.prototype.updateDelegate = function (mCenter, r) {\n    var self = this;\n    var graph = self.get('graph');\n    var lensDelegate = self.get('delegate');\n\n    if (!lensDelegate || lensDelegate.destroyed) {\n      // 拖动多个\n      var parent_1 = graph.get('group');\n      var attrs = self.get('delegateStyle') || lensDelegateStyle; // model上的x, y是相对于图形中心的，delegateShape是g实例，x,y是绝对坐标\n\n      lensDelegate = parent_1.addShape('circle', {\n        attrs: __assign({\n          r: r / 1.5,\n          x: mCenter.x,\n          y: mCenter.y\n        }, attrs),\n        name: 'lens-shape',\n        draggable: true\n      });\n\n      if (this.get('scaleRByWheel')) {\n        lensDelegate.on('mousewheel', function (evt) {\n          self.scaleRange(evt);\n        });\n      }\n\n      lensDelegate.on('dragstart', function (e) {\n        self.set('dragging', true);\n        self.set('cacheCenter', {\n          x: e.x,\n          y: e.y\n        });\n        self.set('dragPrePos', {\n          x: e.x,\n          y: e.y\n        });\n      });\n      lensDelegate.on('drag', function (e) {\n        var dragPrePos = self.get('dragPrePos');\n        var delta = e.x - dragPrePos.x > 0 ? 0.1 : -0.1;\n        var d = self.get('d');\n        var newD = d + delta;\n        var maxD = self.get('maxD');\n        var minD = self.get('minD');\n\n        if (newD < maxD && newD > minD) {\n          self.set('d', newD);\n          r = self.get('r');\n          self.set('molecularParam', (newD + 1) * r);\n          self.magnify(e);\n        }\n\n        self.set('dragPrePos', {\n          x: e.x,\n          y: e.y\n        });\n      });\n      lensDelegate.on('dragend', function (e) {\n        self.set('dragging', false);\n      });\n    } else {\n      lensDelegate.attr({\n        x: mCenter.x,\n        y: mCenter.y,\n        r: r / 1.5\n      });\n    }\n\n    self.set('delegate', lensDelegate);\n  };\n\n  Fisheye.prototype.clear = function () {\n    var graph = this.get('graph');\n    this.restoreCache();\n    graph.refreshPositions();\n    var lensDelegate = this.get('delegate');\n\n    if (lensDelegate && !lensDelegate.destroyed) {\n      lensDelegate.remove();\n      lensDelegate.destroy();\n    }\n  };\n\n  Fisheye.prototype.destroy = function () {\n    this.clear();\n  };\n\n  return Fisheye;\n}(Base);\n\nexport default Fisheye;"]},"metadata":{},"sourceType":"module"}